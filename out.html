<html lang="en">
        <head>
          <meta charset="UTF-8">
          <meta http-equiv="X-UA-Compatible" content="IE=edge">
          <meta name="viewport" content="width=device-width, initial-scale=1.0">
          <link rel="stylesheet" href="./style.css">
          <title>Syntax Highlighter</title>
        </head>
        <body>
          <pre>
            <code>
              <span class="string">"""</span><span class="identifier">README</span><span class="delimiter">,</span> <span class="identifier">Author</span> <span class="operator">-</span> <span class="identifier">Anurag</span> <span class="identifier">Kumar</span><span class="delimiter">(</span><span class="identifier">mailto</span><span class="delimiter">:</span><span class="identifier">anuragkumarak95</span><span class="operator">@</span><span class="identifier">gmail</span><span class="delimiter">.</span><span class="identifier">com</span><span class="delimiter">)</span>
<span class="identifier">Requirements</span><span class="delimiter">:</span>
  <span class="operator">-</span> <span class="identifier">sklearn</span>
  <span class="operator">-</span> <span class="identifier">numpy</span>
  <span class="operator">-</span> <span class="identifier">matplotlib</span>
<span class="identifier">Python</span><span class="delimiter">:</span>
  <span class="operator">-</span> <span class="number">3.5</span>
<span class="identifier">Inputs</span><span class="delimiter">:</span>
  <span class="operator">-</span> <span class="identifier">X</span> <span class="delimiter">,</span> <span class="identifier">a</span> <span class="number">2</span><span class="identifier">D</span> <span class="identifier">numpy</span> <span class="identifier">array</span> <span class="identifier">of</span> <span class="identifier">features</span><span class="delimiter">.</span>
  <span class="operator">-</span> <span class="identifier">k</span> <span class="delimiter">,</span> <span class="identifier">number</span> <span class="identifier">of</span> <span class="identifier">clusters</span> <span class="identifier">to</span> <span class="identifier">create</span><span class="delimiter">.</span>
  <span class="operator">-</span> <span class="identifier">initial_centroids</span> <span class="delimiter">,</span> <span class="identifier">initial</span> <span class="identifier">centroid</span> <span class="identifier">values</span> <span class="identifier">generated</span> <span class="identifier">by</span> <span class="identifier">utility</span> <span class="identifier">function</span><span class="delimiter">(</span><span class="identifier">mentioned</span>
    <span class="keyword">in</span> <span class="identifier">usage</span><span class="delimiter">)</span><span class="delimiter">.</span>
  <span class="operator">-</span> <span class="identifier">maxiter</span> <span class="delimiter">,</span> <span class="identifier">maximum</span> <span class="identifier">number</span> <span class="identifier">of</span> <span class="identifier">iterations</span> <span class="identifier">to</span> <span class="identifier">process</span><span class="delimiter">.</span>
  <span class="operator">-</span> <span class="identifier">heterogeneity</span> <span class="delimiter">,</span> <span class="identifier">empty</span> <span class="built_in_function">list</span> <span class="identifier">that</span> <span class="identifier">will</span> <span class="identifier">be</span> <span class="identifier">filled</span> <span class="keyword">with</span> <span class="identifier">hetrogeneity</span> <span class="identifier">values</span> <span class="keyword">if</span> <span class="identifier">passed</span>
    <span class="identifier">to</span> <span class="identifier">kmeans</span> <span class="identifier">func</span><span class="delimiter">.</span>
<span class="identifier">Usage</span><span class="delimiter">:</span>
  <span class="number">1</span><span class="delimiter">.</span> <span class="identifier">define</span> <span class="string">'k' value, 'X' features array and 'hetrogeneity'</span> <span class="identifier">empty</span> <span class="built_in_function">list</span>
  <span class="number">2</span><span class="delimiter">.</span> <span class="identifier">create</span> <span class="identifier">initial_centroids</span><span class="delimiter">,</span>
        <span class="identifier">initial_centroids</span> <span class="delimiter">=</span> <span class="identifier">get_initial_centroids</span><span class="delimiter">(</span>
            <span class="identifier">X</span><span class="delimiter">,</span>
            <span class="identifier">k</span><span class="delimiter">,</span>
            <span class="identifier">seed</span><span class="delimiter">=</span><span class="number">0</span> <span class="comment"># seed value for initial centroid generation,</span>
                   <span class="comment"># None for randomness(default=None)</span>
            <span class="delimiter">)</span>
  <span class="number">3</span><span class="delimiter">.</span> <span class="identifier">find</span> <span class="identifier">centroids</span> <span class="keyword">and</span> <span class="identifier">clusters</span> <span class="identifier">using</span> <span class="identifier">kmeans</span> <span class="identifier">function</span><span class="delimiter">.</span>
        <span class="identifier">centroids</span><span class="delimiter">,</span> <span class="identifier">cluster_assignment</span> <span class="delimiter">=</span> <span class="identifier">kmeans</span><span class="delimiter">(</span>
            <span class="identifier">X</span><span class="delimiter">,</span>
            <span class="identifier">k</span><span class="delimiter">,</span>
            <span class="identifier">initial_centroids</span><span class="delimiter">,</span>
            <span class="identifier">maxiter</span><span class="delimiter">=</span><span class="number">400</span><span class="delimiter">,</span>
            <span class="identifier">record_heterogeneity</span><span class="delimiter">=</span><span class="identifier">heterogeneity</span><span class="delimiter">,</span>
            <span class="identifier">verbose</span><span class="delimiter">=</span><span class="keyword">True</span> <span class="comment"># whether to print logs in console or not.(default=False)</span>
            <span class="delimiter">)</span>
  <span class="number">4</span><span class="delimiter">.</span> <span class="identifier">Plot</span> <span class="identifier">the</span> <span class="identifier">loss</span> <span class="identifier">function</span><span class="delimiter">,</span> <span class="identifier">hetrogeneity</span> <span class="identifier">values</span> <span class="keyword">for</span> <span class="identifier">every</span> <span class="identifier">iteration</span> <span class="identifier">saved</span> <span class="keyword">in</span>
     <span class="identifier">hetrogeneity</span> <span class="built_in_function">list</span><span class="delimiter">.</span>
        <span class="identifier">plot_heterogeneity</span><span class="delimiter">(</span>
            <span class="identifier">heterogeneity</span><span class="delimiter">,</span>
            <span class="identifier">k</span>
        <span class="delimiter">)</span>
  <span class="number">5</span><span class="delimiter">.</span> <span class="identifier">Transfers</span> <span class="identifier">Dataframe</span> <span class="identifier">into</span> <span class="identifier">excel</span> <span class="built_in_function">format</span> <span class="identifier">it</span> <span class="identifier">must</span> <span class="identifier">have</span> <span class="identifier">feature</span> <span class="identifier">called</span>
      <span class="string">'Clust'</span> <span class="keyword">with</span> <span class="identifier">k</span> <span class="identifier">means</span> <span class="identifier">clustering</span> <span class="identifier">numbers</span> <span class="keyword">in</span> <span class="identifier">it</span><span class="delimiter">.</span>
<span class="string">"""</span>
<span class="keyword">import</span> <span class="identifier">warnings</span>

<span class="keyword">import</span> <span class="identifier">numpy</span> <span class="keyword">as</span> <span class="identifier">np</span>
<span class="keyword">import</span> <span class="identifier">pandas</span> <span class="keyword">as</span> <span class="identifier">pd</span>
<span class="keyword">from</span> <span class="identifier">matplotlib</span> <span class="keyword">import</span> <span class="identifier">pyplot</span> <span class="keyword">as</span> <span class="identifier">plt</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="delimiter">.</span><span class="identifier">metrics</span> <span class="keyword">import</span> <span class="identifier">pairwise_distances</span>

<span class="identifier">warnings</span><span class="delimiter">.</span><span class="identifier">filterwarnings</span><span class="delimiter">(</span><span class="string">"ignore"</span><span class="delimiter">)</span>

<span class="identifier">TAG</span> <span class="delimiter">=</span> <span class="string">"K-MEANS-CLUST/ "</span>


<span class="keyword">def</span> <span class="identifier">get_initial_centroids</span><span class="delimiter">(</span><span class="identifier">data</span><span class="delimiter">,</span> <span class="identifier">k</span><span class="delimiter">,</span> <span class="identifier">seed</span><span class="delimiter">=</span><span class="keyword">None</span><span class="delimiter">)</span><span class="delimiter">:</span>
    <span class="string">"""Randomly choose k data points as initial centroids"""</span>
    <span class="keyword">if</span> <span class="identifier">seed</span> <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span><span class="delimiter">:</span>  <span class="comment"># useful for obtaining consistent results</span>
        <span class="identifier">np</span><span class="delimiter">.</span><span class="identifier">random</span><span class="delimiter">.</span><span class="identifier">seed</span><span class="delimiter">(</span><span class="identifier">seed</span><span class="delimiter">)</span>
    <span class="identifier">n</span> <span class="delimiter">=</span> <span class="identifier">data</span><span class="delimiter">.</span><span class="identifier">shape</span><span class="delimiter">[</span><span class="number">0</span><span class="delimiter">]</span>  <span class="comment"># number of data points</span>

    <span class="comment"># Pick K indices from range [0, N).</span>
    <span class="identifier">rand_indices</span> <span class="delimiter">=</span> <span class="identifier">np</span><span class="delimiter">.</span><span class="identifier">random</span><span class="delimiter">.</span><span class="identifier">randint</span><span class="delimiter">(</span><span class="number">0</span><span class="delimiter">,</span> <span class="identifier">n</span><span class="delimiter">,</span> <span class="identifier">k</span><span class="delimiter">)</span>

    <span class="comment"># Keep centroids as dense format, as many entries will be nonzero due to averaging.</span>
    <span class="comment"># As long as at least one document in a cluster contains a word,</span>
    <span class="comment"># it will carry a nonzero weight in the TF-IDF vector of the centroid.</span>
    <span class="identifier">centroids</span> <span class="delimiter">=</span> <span class="identifier">data</span><span class="delimiter">[</span><span class="identifier">rand_indices</span><span class="delimiter">,</span> <span class="delimiter">:</span><span class="delimiter">]</span>

    <span class="keyword">return</span> <span class="identifier">centroids</span>


<span class="keyword">def</span> <span class="identifier">centroid_pairwise_dist</span><span class="delimiter">(</span><span class="identifier">x</span><span class="delimiter">,</span> <span class="identifier">centroids</span><span class="delimiter">)</span><span class="delimiter">:</span>
    <span class="keyword">return</span> <span class="identifier">pairwise_distances</span><span class="delimiter">(</span><span class="identifier">x</span><span class="delimiter">,</span> <span class="identifier">centroids</span><span class="delimiter">,</span> <span class="identifier">metric</span><span class="delimiter">=</span><span class="string">"euclidean"</span><span class="delimiter">)</span>


<span class="keyword">def</span> <span class="identifier">assign_clusters</span><span class="delimiter">(</span><span class="identifier">data</span><span class="delimiter">,</span> <span class="identifier">centroids</span><span class="delimiter">)</span><span class="delimiter">:</span>
    <span class="comment"># Compute distances between each data point and the set of centroids:</span>
    <span class="comment"># Fill in the blank (RHS only)</span>
    <span class="identifier">distances_from_centroids</span> <span class="delimiter">=</span> <span class="identifier">centroid_pairwise_dist</span><span class="delimiter">(</span><span class="identifier">data</span><span class="delimiter">,</span> <span class="identifier">centroids</span><span class="delimiter">)</span>

    <span class="comment"># Compute cluster assignments for each data point:</span>
    <span class="comment"># Fill in the blank (RHS only)</span>
    <span class="identifier">cluster_assignment</span> <span class="delimiter">=</span> <span class="identifier">np</span><span class="delimiter">.</span><span class="identifier">argmin</span><span class="delimiter">(</span><span class="identifier">distances_from_centroids</span><span class="delimiter">,</span> <span class="identifier">axis</span><span class="delimiter">=</span><span class="number">1</span><span class="delimiter">)</span>

    <span class="keyword">return</span> <span class="identifier">cluster_assignment</span>


<span class="keyword">def</span> <span class="identifier">revise_centroids</span><span class="delimiter">(</span><span class="identifier">data</span><span class="delimiter">,</span> <span class="identifier">k</span><span class="delimiter">,</span> <span class="identifier">cluster_assignment</span><span class="delimiter">)</span><span class="delimiter">:</span>
    <span class="identifier">new_centroids</span> <span class="delimiter">=</span> <span class="delimiter">[</span><span class="delimiter">]</span>
    <span class="keyword">for</span> <span class="identifier">i</span> <span class="keyword">in</span> <span class="built_in_function">range</span><span class="delimiter">(</span><span class="identifier">k</span><span class="delimiter">)</span><span class="delimiter">:</span>
        <span class="comment"># Select all data points that belong to cluster i. Fill in the blank (RHS only)</span>
        <span class="identifier">member_data_points</span> <span class="delimiter">=</span> <span class="identifier">data</span><span class="delimiter">[</span><span class="identifier">cluster_assignment</span> <span class="delimiter">=</span> <span class="identifier">i</span><span class="delimiter">]</span>
        <span class="comment"># Compute the mean of the data points. Fill in the blank (RHS only)</span>
        <span class="identifier">centroid</span> <span class="delimiter">=</span> <span class="identifier">member_data_points</span><span class="delimiter">.</span><span class="identifier">mean</span><span class="delimiter">(</span><span class="identifier">axis</span><span class="delimiter">=</span><span class="number">0</span><span class="delimiter">)</span>
        <span class="identifier">new_centroids</span><span class="delimiter">.</span><span class="built_in_function">append</span><span class="delimiter">(</span><span class="identifier">centroid</span><span class="delimiter">)</span>
    <span class="identifier">new_centroids</span> <span class="delimiter">=</span> <span class="identifier">np</span><span class="delimiter">.</span><span class="identifier">array</span><span class="delimiter">(</span><span class="identifier">new_centroids</span><span class="delimiter">)</span>

    <span class="keyword">return</span> <span class="identifier">new_centroids</span>


<span class="keyword">def</span> <span class="identifier">compute_heterogeneity</span><span class="delimiter">(</span><span class="identifier">data</span><span class="delimiter">,</span> <span class="identifier">k</span><span class="delimiter">,</span> <span class="identifier">centroids</span><span class="delimiter">,</span> <span class="identifier">cluster_assignment</span><span class="delimiter">)</span><span class="delimiter">:</span>
    <span class="identifier">heterogeneity</span> <span class="delimiter">=</span> <span class="number">0.0</span>
    <span class="keyword">for</span> <span class="identifier">i</span> <span class="keyword">in</span> <span class="built_in_function">range</span><span class="delimiter">(</span><span class="identifier">k</span><span class="delimiter">)</span><span class="delimiter">:</span>
        <span class="comment"># Select all data points that belong to cluster i. Fill in the blank (RHS only)</span>
        <span class="identifier">member_data_points</span> <span class="delimiter">=</span> <span class="identifier">data</span><span class="delimiter">[</span><span class="identifier">cluster_assignment</span> <span class="delimiter">=</span> <span class="identifier">i</span><span class="delimiter">,</span> <span class="delimiter">:</span><span class="delimiter">]</span>

        <span class="keyword">if</span> <span class="identifier">member_data_points</span><span class="delimiter">.</span><span class="identifier">shape</span><span class="delimiter">[</span><span class="number">0</span><span class="delimiter">]</span> <span class="operator">></span> <span class="number">0</span><span class="delimiter">:</span>  <span class="comment"># check if i-th cluster is non-empty</span>
            <span class="comment"># Compute distances from centroid to data points (RHS only)</span>
            <span class="identifier">distances</span> <span class="delimiter">=</span> <span class="identifier">pairwise_distances</span><span class="delimiter">(</span>
                <span class="identifier">member_data_points</span><span class="delimiter">,</span> <span class="delimiter">[</span><span class="identifier">centroids</span><span class="delimiter">[</span><span class="identifier">i</span><span class="delimiter">]</span><span class="delimiter">,</span> <span class="identifier">metric</span><span class="delimiter">=</span><span class="string">"euclidean"</span>
            <span class="delimiter">)</span>
            <span class="identifier">squared_distances</span> <span class="delimiter">=</span> <span class="identifier">distances</span><span class="operator">**</span><span class="number">2</span>
            <span class="identifier">heterogeneity</span> <span class="operator">+=</span> <span class="identifier">np</span><span class="delimiter">.</span><span class="built_in_function">sum</span><span class="delimiter">(</span><span class="identifier">squared_distances</span><span class="delimiter">)</span>

    <span class="keyword">return</span> <span class="identifier">heterogeneity</span>


<span class="keyword">def</span> <span class="identifier">plot_heterogeneity</span><span class="delimiter">(</span><span class="identifier">heterogeneity</span><span class="delimiter">,</span> <span class="identifier">k</span><span class="delimiter">)</span><span class="delimiter">:</span>
    <span class="identifier">plt</span><span class="delimiter">.</span><span class="identifier">figure</span><span class="delimiter">(</span><span class="identifier">figsize</span><span class="delimiter">=</span><span class="delimiter">(</span><span class="number">7</span><span class="delimiter">,</span> <span class="number">4</span><span class="delimiter">)</span>
    <span class="identifier">plt</span><span class="delimiter">.</span><span class="identifier">plot</span><span class="delimiter">(</span><span class="identifier">heterogeneity</span><span class="delimiter">,</span> <span class="identifier">linewidth</span><span class="delimiter">=</span><span class="number">4</span><span class="delimiter">)</span>
    <span class="identifier">plt</span><span class="delimiter">.</span><span class="identifier">xlabel</span><span class="delimiter">(</span><span class="string">"# Iterations"</span><span class="delimiter">)</span>
    <span class="identifier">plt</span><span class="delimiter">.</span><span class="identifier">ylabel</span><span class="delimiter">(</span><span class="string">"Heterogeneity"</span><span class="delimiter">)</span>
    <span class="identifier">plt</span><span class="delimiter">.</span><span class="identifier">title</span><span class="delimiter">(</span><span class="identifier">f</span><span class="string">"Heterogeneity of clustering over time, K={k:d}"</span><span class="delimiter">)</span>
    <span class="identifier">plt</span><span class="delimiter">.</span><span class="identifier">rcParams</span><span class="delimiter">.</span><span class="identifier">update</span><span class="delimiter">(</span><span class="delimiter">{</span><span class="string">"font.size"</span><span class="delimiter">:</span> <span class="number">16</span><span class="delimiter">}</span><span class="delimiter">)</span>
    <span class="identifier">plt</span><span class="delimiter">.</span><span class="identifier">show</span><span class="delimiter">(</span><span class="delimiter">)</span>


<span class="keyword">def</span> <span class="identifier">kmeans</span><span class="delimiter">(</span>
    <span class="identifier">data</span><span class="delimiter">,</span> <span class="identifier">k</span><span class="delimiter">,</span> <span class="identifier">initial_centroids</span><span class="delimiter">,</span> <span class="identifier">maxiter</span><span class="delimiter">=</span><span class="number">500</span><span class="delimiter">,</span> <span class="identifier">record_heterogeneity</span><span class="delimiter">=</span><span class="keyword">None</span><span class="delimiter">,</span> <span class="identifier">verbose</span><span class="delimiter">=</span><span class="keyword">False</span>
<span class="delimiter">)</span><span class="delimiter">:</span>
    <span class="string">"""</span><span class="identifier">This</span> <span class="identifier">function</span> <span class="identifier">runs</span> <span class="identifier">k</span><span class="operator">-</span><span class="identifier">means</span> <span class="identifier">on</span> <span class="identifier">given</span> <span class="identifier">data</span> <span class="keyword">and</span> <span class="identifier">initial</span> <span class="built_in_function">set</span> <span class="identifier">of</span> <span class="identifier">centroids</span><span class="delimiter">.</span>
    <span class="identifier">maxiter</span><span class="delimiter">:</span> <span class="identifier">maximum</span> <span class="identifier">number</span> <span class="identifier">of</span> <span class="identifier">iterations</span> <span class="identifier">to</span> <span class="identifier">run</span><span class="delimiter">.</span><span class="delimiter">(</span><span class="identifier">default</span><span class="delimiter">=</span><span class="number">500</span><span class="delimiter">)</span>
    <span class="identifier">record_heterogeneity</span><span class="delimiter">:</span> <span class="delimiter">(</span><span class="identifier">optional</span><span class="delimiter">)</span> <span class="identifier">a</span> <span class="built_in_function">list</span><span class="delimiter">,</span> <span class="identifier">to</span> <span class="identifier">store</span> <span class="identifier">the</span> <span class="identifier">history</span> <span class="identifier">of</span> <span class="identifier">heterogeneity</span>
                          <span class="keyword">as</span> <span class="identifier">function</span> <span class="identifier">of</span> <span class="identifier">iterations</span>
                          <span class="keyword">if</span> <span class="keyword">None</span><span class="delimiter">,</span> <span class="identifier">do</span> <span class="keyword">not</span> <span class="identifier">store</span> <span class="identifier">the</span> <span class="identifier">history</span><span class="delimiter">.</span>
    <span class="identifier">verbose</span><span class="delimiter">:</span> <span class="keyword">if</span> <span class="keyword">True</span><span class="delimiter">,</span> <span class="keyword">print</span> <span class="identifier">how</span> <span class="identifier">many</span> <span class="identifier">data</span> <span class="identifier">points</span> <span class="identifier">changed</span> <span class="identifier">their</span> <span class="identifier">cluster</span> <span class="identifier">labels</span> <span class="keyword">in</span>
                          <span class="identifier">each</span> <span class="identifier">iteration</span><span class="string">"""</span>
    <span class="identifier">centroids</span> <span class="delimiter">=</span> <span class="identifier">initial_centroids</span><span class="delimiter">[</span><span class="delimiter">:</span><span class="delimiter">]</span>
    <span class="identifier">prev_cluster_assignment</span> <span class="delimiter">=</span> <span class="keyword">None</span>

    <span class="keyword">for</span> <span class="identifier">itr</span> <span class="keyword">in</span> <span class="built_in_function">range</span><span class="delimiter">(</span><span class="identifier">maxiter</span><span class="delimiter">)</span><span class="delimiter">:</span>
        <span class="keyword">if</span> <span class="identifier">verbose</span><span class="delimiter">:</span>
            <span class="keyword">print</span><span class="delimiter">(</span><span class="identifier">itr</span><span class="delimiter">,</span> <span class="identifier">end</span><span class="delimiter">=</span><span class="string">""</span><span class="delimiter">)</span>

        <span class="comment"># 1. Make cluster assignments using nearest centroids</span>
        <span class="identifier">cluster_assignment</span> <span class="delimiter">=</span> <span class="identifier">assign_clusters</span><span class="delimiter">(</span><span class="identifier">data</span><span class="delimiter">,</span> <span class="identifier">centroids</span><span class="delimiter">)</span>

        <span class="comment"># 2. Compute a new centroid for each of the k clusters, averaging all data</span>
        <span class="comment">#    points assigned to that cluster.</span>
        <span class="identifier">centroids</span> <span class="delimiter">=</span> <span class="identifier">revise_centroids</span><span class="delimiter">(</span><span class="identifier">data</span><span class="delimiter">,</span> <span class="identifier">k</span><span class="delimiter">,</span> <span class="identifier">cluster_assignment</span><span class="delimiter">)</span>

        <span class="comment"># Check for convergence: if none of the assignments changed, stop</span>
        <span class="keyword">if</span> <span class="delimiter">(</span>
            <span class="identifier">prev_cluster_assignment</span> <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>
            <span class="keyword">and</span> <span class="delimiter">(</span><span class="identifier">prev_cluster_assignment</span> <span class="delimiter">=</span> <span class="identifier">cluster_assignment</span><span class="delimiter">)</span><span class="delimiter">.</span><span class="built_in_function">all</span><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="delimiter">)</span><span class="delimiter">:</span>
            <span class="keyword">break</span>

        <span class="comment"># Print number of new assignments</span>
        <span class="keyword">if</span> <span class="identifier">prev_cluster_assignment</span> <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span><span class="delimiter">:</span>
            <span class="identifier">num_changed</span> <span class="delimiter">=</span> <span class="identifier">np</span><span class="delimiter">.</span><span class="built_in_function">sum</span><span class="delimiter">(</span><span class="identifier">prev_cluster_assignment</span> <span class="operator">!=</span> <span class="identifier">cluster_assignment</span><span class="delimiter">)</span>
            <span class="keyword">if</span> <span class="identifier">verbose</span><span class="delimiter">:</span>
                <span class="keyword">print</span><span class="delimiter">(</span>
                    <span class="identifier">f</span><span class="string">"    {num_changed:5d} elements changed their cluster assignment."</span>
                <span class="delimiter">)</span>

        <span class="comment"># Record heterogeneity convergence metric</span>
        <span class="keyword">if</span> <span class="identifier">record_heterogeneity</span> <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span><span class="delimiter">:</span>
            <span class="comment"># YOUR CODE HERE</span>
            <span class="identifier">score</span> <span class="delimiter">=</span> <span class="identifier">compute_heterogeneity</span><span class="delimiter">(</span><span class="identifier">data</span><span class="delimiter">,</span> <span class="identifier">k</span><span class="delimiter">,</span> <span class="identifier">centroids</span><span class="delimiter">,</span> <span class="identifier">cluster_assignment</span><span class="delimiter">)</span>
            <span class="identifier">record_heterogeneity</span><span class="delimiter">.</span><span class="built_in_function">append</span><span class="delimiter">(</span><span class="identifier">score</span><span class="delimiter">)</span>

        <span class="identifier">prev_cluster_assignment</span> <span class="delimiter">=</span> <span class="identifier">cluster_assignment</span><span class="delimiter">[</span><span class="delimiter">:</span><span class="delimiter">]</span>

    <span class="keyword">return</span> <span class="identifier">centroids</span><span class="delimiter">,</span> <span class="identifier">cluster_assignment</span>


<span class="comment"># Mock test below</span>
<span class="keyword">if</span> <span class="keyword">False</span><span class="delimiter">:</span>  <span class="comment"># change to true to run this test case.</span>
    <span class="keyword">from</span> <span class="identifier">sklearn</span> <span class="keyword">import</span> <span class="identifier">datasets</span> <span class="keyword">as</span> <span class="identifier">ds</span>

    <span class="identifier">dataset</span> <span class="delimiter">=</span> <span class="identifier">ds</span><span class="delimiter">.</span><span class="identifier">load_iris</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="identifier">k</span> <span class="delimiter">=</span> <span class="number">3</span>
    <span class="identifier">heterogeneity</span> <span class="delimiter">=</span> <span class="delimiter">[</span><span class="delimiter">]</span>
    <span class="identifier">initial_centroids</span> <span class="delimiter">=</span> <span class="identifier">get_initial_centroids</span><span class="delimiter">(</span><span class="identifier">dataset</span><span class="delimiter">[</span><span class="string">"data"</span><span class="delimiter">]</span><span class="delimiter">,</span> <span class="identifier">k</span><span class="delimiter">,</span> <span class="identifier">seed</span><span class="delimiter">=</span><span class="number">0</span><span class="delimiter">)</span>
    <span class="identifier">centroids</span><span class="delimiter">,</span> <span class="identifier">cluster_assignment</span> <span class="delimiter">=</span> <span class="identifier">kmeans</span><span class="delimiter">(</span>
        <span class="identifier">dataset</span><span class="delimiter">[</span><span class="string">"data"</span><span class="delimiter">]</span><span class="delimiter">,</span>
        <span class="identifier">k</span><span class="delimiter">,</span>
        <span class="identifier">initial_centroids</span><span class="delimiter">,</span>
        <span class="identifier">maxiter</span><span class="delimiter">=</span><span class="number">400</span><span class="delimiter">,</span>
        <span class="identifier">record_heterogeneity</span><span class="delimiter">=</span><span class="identifier">heterogeneity</span><span class="delimiter">,</span>
        <span class="identifier">verbose</span><span class="delimiter">=</span><span class="keyword">True</span><span class="delimiter">,</span>
    <span class="delimiter">)</span>
    <span class="identifier">plot_heterogeneity</span><span class="delimiter">(</span><span class="identifier">heterogeneity</span><span class="delimiter">,</span> <span class="identifier">k</span><span class="delimiter">)</span>


<span class="keyword">def</span> <span class="identifier">report_generator</span><span class="delimiter">(</span>
    <span class="identifier">df</span><span class="delimiter">:</span> <span class="identifier">pd</span><span class="delimiter">.</span><span class="identifier">DataFrame</span><span class="delimiter">,</span> <span class="identifier">clustering_variables</span><span class="delimiter">:</span> <span class="identifier">np</span><span class="delimiter">.</span><span class="identifier">ndarray</span><span class="delimiter">,</span> <span class="identifier">fill_missing_report</span><span class="delimiter">=</span><span class="keyword">None</span>
<span class="delimiter">)</span> <span class="operator">-</span><span class="operator">></span> <span class="identifier">pd</span><span class="delimiter">.</span><span class="identifier">DataFrame</span><span class="delimiter">:</span>
    <span class="string">"""</span>
    <span class="identifier">Function</span> <span class="identifier">generates</span> <span class="identifier">easy</span><span class="operator">-</span><span class="identifier">erading</span> <span class="identifier">clustering</span> <span class="identifier">report</span><span class="delimiter">.</span> <span class="identifier">It</span> <span class="identifier">takes</span> <span class="number">2</span> <span class="identifier">arguments</span> <span class="keyword">as</span> <span class="identifier">an</span> <span class="built_in_function">input</span><span class="delimiter">:</span>
        <span class="identifier">DataFrame</span> <span class="operator">-</span> <span class="identifier">dataframe</span> <span class="keyword">with</span> <span class="identifier">predicted</span> <span class="identifier">cluester</span> <span class="identifier">column</span><span class="delimiter">;</span>
        <span class="identifier">FillMissingReport</span> <span class="operator">-</span> <span class="identifier">dictionary</span> <span class="identifier">of</span> <span class="identifier">rules</span> <span class="identifier">how</span> <span class="identifier">we</span> <span class="identifier">are</span> <span class="identifier">going</span> <span class="identifier">to</span> <span class="identifier">fill</span> <span class="identifier">missing</span>
        <span class="identifier">values</span> <span class="identifier">of</span> <span class="keyword">for</span> <span class="identifier">final</span> <span class="identifier">report</span> <span class="identifier">generate</span> <span class="delimiter">(</span><span class="keyword">not</span> <span class="identifier">included</span> <span class="keyword">in</span> <span class="identifier">modeling</span><span class="delimiter">)</span><span class="delimiter">;</span>
    <span class="keyword">in</span> <span class="identifier">order</span> <span class="identifier">to</span> <span class="identifier">run</span> <span class="identifier">the</span> <span class="identifier">function</span> <span class="identifier">following</span> <span class="identifier">libraries</span> <span class="identifier">must</span> <span class="identifier">be</span> <span class="identifier">imported</span><span class="delimiter">:</span>
        <span class="keyword">import</span> <span class="identifier">pandas</span> <span class="keyword">as</span> <span class="identifier">pd</span>
        <span class="keyword">import</span> <span class="identifier">numpy</span> <span class="keyword">as</span> <span class="identifier">np</span>
    <span class="operator">>></span><span class="operator">></span> <span class="identifier">data</span> <span class="delimiter">=</span> <span class="identifier">pd</span><span class="delimiter">.</span><span class="identifier">DataFrame</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="operator">>></span><span class="operator">></span> <span class="identifier">data</span><span class="delimiter">[</span><span class="string">'numbers'</span><span class="delimiter">]</span> <span class="delimiter">=</span> <span class="delimiter">[</span><span class="number">1</span><span class="delimiter">,</span> <span class="number">2</span><span class="delimiter">,</span> <span class="number">3</span><span class="delimiter">]</span>
    <span class="operator">>></span><span class="operator">></span> <span class="identifier">data</span><span class="delimiter">[</span><span class="string">'col1'</span><span class="delimiter">]</span> <span class="delimiter">=</span> <span class="delimiter">[</span><span class="number">0.5</span><span class="delimiter">,</span> <span class="number">2.5</span><span class="delimiter">,</span> <span class="number">4.5</span><span class="delimiter">]</span>
    <span class="operator">>></span><span class="operator">></span> <span class="identifier">data</span><span class="delimiter">[</span><span class="string">'col2'</span><span class="delimiter">]</span> <span class="delimiter">=</span> <span class="delimiter">[</span><span class="number">100</span><span class="delimiter">,</span> <span class="number">200</span><span class="delimiter">,</span> <span class="number">300</span><span class="delimiter">]</span>
    <span class="operator">>></span><span class="operator">></span> <span class="identifier">data</span><span class="delimiter">[</span><span class="string">'col3'</span><span class="delimiter">]</span> <span class="delimiter">=</span> <span class="delimiter">[</span><span class="number">10</span><span class="delimiter">,</span> <span class="number">20</span><span class="delimiter">,</span> <span class="number">30</span><span class="delimiter">]</span>
    <span class="operator">>></span><span class="operator">></span> <span class="identifier">data</span><span class="delimiter">[</span><span class="string">'Cluster'</span><span class="delimiter">]</span> <span class="delimiter">=</span> <span class="delimiter">[</span><span class="number">1</span><span class="delimiter">,</span> <span class="number">1</span><span class="delimiter">,</span> <span class="number">2</span><span class="delimiter">]</span>
    <span class="operator">>></span><span class="operator">></span> <span class="identifier">report_generator</span><span class="delimiter">(</span><span class="identifier">data</span><span class="delimiter">,</span> <span class="delimiter">[</span><span class="string">'col1', 'col2'</span><span class="delimiter">]</span><span class="delimiter">,</span> <span class="number">0</span><span class="delimiter">)</span>
               <span class="identifier">Features</span>               <span class="identifier">Type</span>   <span class="identifier">Mark</span>           <span class="number">1</span>           <span class="number">2</span>
    <span class="number">0</span>    <span class="comment"># of Customers        ClusterSize  False    2.000000    1.000000</span>
    <span class="number">1</span>    <span class="operator">%</span> <span class="identifier">of</span> <span class="identifier">Customers</span>  <span class="identifier">ClusterProportion</span>  <span class="keyword">False</span>    <span class="number">0.666667</span>    <span class="number">0.333333</span>
    <span class="number">2</span>              <span class="identifier">col1</span>    <span class="identifier">mean_with_zeros</span>   <span class="keyword">True</span>    <span class="number">1.500000</span>    <span class="number">4.500000</span>
    <span class="number">3</span>              <span class="identifier">col2</span>    <span class="identifier">mean_with_zeros</span>   <span class="keyword">True</span>  <span class="number">150.000000</span>  <span class="number">300.000000</span>
    <span class="number">4</span>           <span class="identifier">numbers</span>    <span class="identifier">mean_with_zeros</span>  <span class="keyword">False</span>    <span class="number">1.500000</span>    <span class="number">3.000000</span>
    <span class="delimiter">.</span>              <span class="delimiter">.</span>                <span class="delimiter">.</span>    <span class="delimiter">.</span>         <span class="delimiter">.</span>         <span class="delimiter">.</span>
    <span class="number">99</span>            <span class="identifier">dummy</span>                 <span class="number">5</span><span class="operator">%</span>  <span class="keyword">False</span>    <span class="number">1.000000</span>    <span class="number">1.000000</span>
    <span class="number">100</span>           <span class="identifier">dummy</span>                <span class="number">95</span><span class="operator">%</span>  <span class="keyword">False</span>    <span class="number">1.000000</span>    <span class="number">1.000000</span>
    <span class="number">101</span>           <span class="identifier">dummy</span>              <span class="identifier">stdev</span>  <span class="keyword">False</span>    <span class="number">0.000000</span>         <span class="identifier">NaN</span>
    <span class="number">102</span>           <span class="identifier">dummy</span>               <span class="identifier">mode</span>  <span class="keyword">False</span>    <span class="number">1.000000</span>    <span class="number">1.000000</span>
    <span class="number">103</span>           <span class="identifier">dummy</span>             <span class="identifier">median</span>  <span class="keyword">False</span>    <span class="number">1.000000</span>    <span class="number">1.000000</span>
    <span class="operator"><</span><span class="identifier">BLANKLINE</span><span class="operator">></span>
    <span class="delimiter">[</span><span class="number">104</span> <span class="identifier">rows</span> <span class="identifier">x</span> <span class="number">5</span> <span class="identifier">columns</span><span class="delimiter">]</span>
    <span class="string">"""</span>
    <span class="comment"># Fill missing values with given rules</span>
    <span class="keyword">if</span> <span class="identifier">fill_missing_report</span><span class="delimiter">:</span>
        <span class="identifier">df</span> <span class="delimiter">=</span> <span class="identifier">df</span><span class="delimiter">.</span><span class="identifier">fillna</span><span class="delimiter">(</span><span class="identifier">value</span><span class="delimiter">=</span><span class="identifier">fill_missing_report</span><span class="delimiter">)</span>
    <span class="identifier">df</span><span class="delimiter">[</span><span class="string">"dummy"</span><span class="delimiter">]</span> <span class="delimiter">=</span> <span class="number">1</span>
    <span class="identifier">numeric_cols</span> <span class="delimiter">=</span> <span class="identifier">df</span><span class="delimiter">.</span><span class="identifier">select_dtypes</span><span class="delimiter">(</span><span class="identifier">np</span><span class="delimiter">.</span><span class="identifier">number</span><span class="delimiter">)</span><span class="delimiter">.</span><span class="identifier">columns</span>
    <span class="identifier">report</span> <span class="delimiter">=</span> <span class="delimiter">(</span>
        <span class="identifier">df</span><span class="delimiter">.</span><span class="identifier">groupby</span><span class="delimiter">(</span><span class="delimiter">[</span><span class="string">"Cluster"</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">[</span>  <span class="comment"># construct report dataframe</span>
            <span class="identifier">numeric_cols</span>
        <span class="delimiter">]</span>  <span class="comment"># group by cluster number</span>
        <span class="delimiter">.</span><span class="identifier">agg</span><span class="delimiter">(</span>
            <span class="delimiter">[</span>
                <span class="delimiter">(</span><span class="string">"sum"</span><span class="delimiter">,</span> <span class="identifier">np</span><span class="delimiter">.</span><span class="built_in_function">sum</span><span class="delimiter">)</span><span class="delimiter">,</span>
                <span class="delimiter">(</span><span class="string">"mean_with_zeros"</span><span class="delimiter">,</span> <span class="keyword">lambda</span> <span class="identifier">x</span><span class="delimiter">:</span> <span class="identifier">np</span><span class="delimiter">.</span><span class="identifier">mean</span><span class="delimiter">(</span><span class="identifier">np</span><span class="delimiter">.</span><span class="identifier">nan_to_num</span><span class="delimiter">(</span><span class="identifier">x</span><span class="delimiter">)</span><span class="delimiter">,</span>
                <span class="delimiter">(</span><span class="string">"mean_without_zeros"</span><span class="delimiter">,</span> <span class="keyword">lambda</span> <span class="identifier">x</span><span class="delimiter">:</span> <span class="identifier">x</span><span class="delimiter">.</span><span class="identifier">replace</span><span class="delimiter">(</span><span class="number">0</span><span class="delimiter">,</span> <span class="identifier">np</span><span class="delimiter">.</span><span class="identifier">NaN</span><span class="delimiter">)</span><span class="delimiter">.</span><span class="identifier">mean</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">,</span>
                <span class="delimiter">(</span>
                    <span class="string">"mean_25-75"</span><span class="delimiter">,</span>
                    <span class="keyword">lambda</span> <span class="identifier">x</span><span class="delimiter">:</span> <span class="identifier">np</span><span class="delimiter">.</span><span class="identifier">mean</span><span class="delimiter">(</span>
                        <span class="identifier">np</span><span class="delimiter">.</span><span class="identifier">nan_to_num</span><span class="delimiter">(</span>
                            <span class="built_in_function">sorted</span><span class="delimiter">(</span><span class="identifier">x</span><span class="delimiter">)</span><span class="delimiter">[</span>
                                <span class="built_in_function">round</span><span class="delimiter">(</span><span class="built_in_function">len</span><span class="delimiter">(</span><span class="identifier">x</span><span class="delimiter">)</span> <span class="operator">*</span> <span class="number">25</span> <span class="operator">/</span> <span class="number">100</span><span class="delimiter">)</span> <span class="delimiter">:</span> <span class="built_in_function">round</span><span class="delimiter">(</span><span class="built_in_function">len</span><span class="delimiter">(</span><span class="identifier">x</span><span class="delimiter">)</span> <span class="operator">*</span> <span class="number">75</span> <span class="operator">/</span> <span class="number">100</span><span class="delimiter">)</span>
                            <span class="delimiter">]</span>
                        <span class="delimiter">)</span>
                    <span class="delimiter">)</span><span class="delimiter">,</span>
                <span class="delimiter">)</span><span class="delimiter">,</span>
                <span class="delimiter">(</span><span class="string">"mean_with_na"</span><span class="delimiter">,</span> <span class="identifier">np</span><span class="delimiter">.</span><span class="identifier">mean</span><span class="delimiter">)</span><span class="delimiter">,</span>
                <span class="delimiter">(</span><span class="string">"min"</span><span class="delimiter">,</span> <span class="keyword">lambda</span> <span class="identifier">x</span><span class="delimiter">:</span> <span class="identifier">x</span><span class="delimiter">.</span><span class="built_in_function">min</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">,</span>
                <span class="delimiter">(</span><span class="string">"5%"</span><span class="delimiter">,</span> <span class="keyword">lambda</span> <span class="identifier">x</span><span class="delimiter">:</span> <span class="identifier">x</span><span class="delimiter">.</span><span class="identifier">quantile</span><span class="delimiter">(</span><span class="number">0.05</span><span class="delimiter">)</span><span class="delimiter">,</span>
                <span class="delimiter">(</span><span class="string">"25%"</span><span class="delimiter">,</span> <span class="keyword">lambda</span> <span class="identifier">x</span><span class="delimiter">:</span> <span class="identifier">x</span><span class="delimiter">.</span><span class="identifier">quantile</span><span class="delimiter">(</span><span class="number">0.25</span><span class="delimiter">)</span><span class="delimiter">,</span>
                <span class="delimiter">(</span><span class="string">"50%"</span><span class="delimiter">,</span> <span class="keyword">lambda</span> <span class="identifier">x</span><span class="delimiter">:</span> <span class="identifier">x</span><span class="delimiter">.</span><span class="identifier">quantile</span><span class="delimiter">(</span><span class="number">0.50</span><span class="delimiter">)</span><span class="delimiter">,</span>
                <span class="delimiter">(</span><span class="string">"75%"</span><span class="delimiter">,</span> <span class="keyword">lambda</span> <span class="identifier">x</span><span class="delimiter">:</span> <span class="identifier">x</span><span class="delimiter">.</span><span class="identifier">quantile</span><span class="delimiter">(</span><span class="number">0.75</span><span class="delimiter">)</span><span class="delimiter">,</span>
                <span class="delimiter">(</span><span class="string">"95%"</span><span class="delimiter">,</span> <span class="keyword">lambda</span> <span class="identifier">x</span><span class="delimiter">:</span> <span class="identifier">x</span><span class="delimiter">.</span><span class="identifier">quantile</span><span class="delimiter">(</span><span class="number">0.95</span><span class="delimiter">)</span><span class="delimiter">,</span>
                <span class="delimiter">(</span><span class="string">"max"</span><span class="delimiter">,</span> <span class="keyword">lambda</span> <span class="identifier">x</span><span class="delimiter">:</span> <span class="identifier">x</span><span class="delimiter">.</span><span class="built_in_function">max</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">,</span>
                <span class="delimiter">(</span><span class="string">"count"</span><span class="delimiter">,</span> <span class="keyword">lambda</span> <span class="identifier">x</span><span class="delimiter">:</span> <span class="identifier">x</span><span class="delimiter">.</span><span class="identifier">count</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">,</span>
                <span class="delimiter">(</span><span class="string">"stdev"</span><span class="delimiter">,</span> <span class="keyword">lambda</span> <span class="identifier">x</span><span class="delimiter">:</span> <span class="identifier">x</span><span class="delimiter">.</span><span class="identifier">std</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">,</span>
                <span class="delimiter">(</span><span class="string">"mode"</span><span class="delimiter">,</span> <span class="keyword">lambda</span> <span class="identifier">x</span><span class="delimiter">:</span> <span class="identifier">x</span><span class="delimiter">.</span><span class="identifier">mode</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">[</span><span class="number">0</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">,</span>
                <span class="delimiter">(</span><span class="string">"median"</span><span class="delimiter">,</span> <span class="keyword">lambda</span> <span class="identifier">x</span><span class="delimiter">:</span> <span class="identifier">x</span><span class="delimiter">.</span><span class="identifier">median</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">,</span>
                <span class="delimiter">(</span><span class="string">"# > 0"</span><span class="delimiter">,</span> <span class="keyword">lambda</span> <span class="identifier">x</span><span class="delimiter">:</span> <span class="delimiter">(</span><span class="identifier">x</span> <span class="operator">></span> <span class="number">0</span><span class="delimiter">)</span><span class="delimiter">.</span><span class="built_in_function">sum</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">,</span>
            <span class="delimiter">]</span>
        <span class="delimiter">)</span>
        <span class="delimiter">.</span><span class="identifier">T</span><span class="delimiter">.</span><span class="identifier">reset_index</span><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="delimiter">.</span><span class="identifier">rename</span><span class="delimiter">(</span><span class="identifier">index</span><span class="delimiter">=</span><span class="built_in_function">str</span><span class="delimiter">,</span> <span class="identifier">columns</span><span class="delimiter">=</span><span class="delimiter">{</span><span class="string">"level_0": "Features", "level_1": "Type"</span><span class="delimiter">}</span><span class="delimiter">)</span>
    <span class="delimiter">)</span>  <span class="comment"># rename columns</span>
    <span class="comment"># calculate the size of cluster(count of clientID's)</span>
    <span class="identifier">clustersize</span> <span class="delimiter">=</span> <span class="identifier">report</span><span class="delimiter">[</span>
        <span class="delimiter">(</span><span class="identifier">report</span><span class="delimiter">[</span><span class="string">"Features"] == "dummy") & (report["Type"] == "count"</span><span class="delimiter">)</span>
    <span class="delimiter">]</span><span class="delimiter">.</span><span class="identifier">copy</span><span class="delimiter">(</span><span class="delimiter">)</span>  <span class="comment"># avoid SettingWithCopyWarning</span>
    <span class="identifier">clustersize</span><span class="delimiter">.</span><span class="identifier">Type</span> <span class="delimiter">=</span> <span class="delimiter">(</span>
        <span class="string">"ClusterSize"</span>  <span class="comment"># rename created cluster df to match report column names</span>
    <span class="delimiter">)</span>
    <span class="identifier">clustersize</span><span class="delimiter">.</span><span class="identifier">Features</span> <span class="delimiter">=</span> <span class="string">"# of Customers"</span>
    <span class="identifier">clusterproportion</span> <span class="delimiter">=</span> <span class="identifier">pd</span><span class="delimiter">.</span><span class="identifier">DataFrame</span><span class="delimiter">(</span>
        <span class="identifier">clustersize</span><span class="delimiter">.</span><span class="identifier">iloc</span><span class="delimiter">[</span><span class="delimiter">:</span><span class="delimiter">,</span> <span class="number">2</span><span class="delimiter">:</span><span class="delimiter">]</span><span class="delimiter">.</span><span class="identifier">values</span>
        <span class="operator">/</span> <span class="identifier">clustersize</span><span class="delimiter">.</span><span class="identifier">iloc</span><span class="delimiter">[</span><span class="delimiter">:</span><span class="delimiter">,</span> <span class="number">2</span><span class="delimiter">:</span><span class="delimiter">]</span><span class="delimiter">.</span><span class="identifier">values</span><span class="delimiter">.</span><span class="built_in_function">sum</span><span class="delimiter">(</span><span class="delimiter">)</span>  <span class="comment"># calculating the proportion of cluster</span>
    <span class="delimiter">)</span>
    <span class="identifier">clusterproportion</span><span class="delimiter">[</span>
        <span class="string">"Type"</span>
    <span class="delimiter">]</span> <span class="delimiter">=</span> <span class="string">"% of Customers"</span>  <span class="comment"># rename created cluster df to match report column names</span>
    <span class="identifier">clusterproportion</span><span class="delimiter">[</span><span class="string">"Features"] = "ClusterProportion"</span>
    <span class="identifier">cols</span> <span class="delimiter">=</span> <span class="identifier">clusterproportion</span><span class="delimiter">.</span><span class="identifier">columns</span><span class="delimiter">.</span><span class="identifier">tolist</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="identifier">cols</span> <span class="delimiter">=</span> <span class="identifier">cols</span><span class="delimiter">[</span><span class="number">-2</span><span class="delimiter">:</span><span class="delimiter">]</span> <span class="operator">+</span> <span class="identifier">cols</span><span class="delimiter">[</span><span class="delimiter">:</span><span class="number">-2</span><span class="delimiter">]</span>
    <span class="identifier">clusterproportion</span> <span class="delimiter">=</span> <span class="identifier">clusterproportion</span><span class="delimiter">[</span><span class="identifier">cols</span><span class="delimiter">]</span>  <span class="comment"># rearrange columns to match report</span>
    <span class="identifier">clusterproportion</span><span class="delimiter">.</span><span class="identifier">columns</span> <span class="delimiter">=</span> <span class="identifier">report</span><span class="delimiter">.</span><span class="identifier">columns</span>
    <span class="identifier">a</span> <span class="delimiter">=</span> <span class="identifier">pd</span><span class="delimiter">.</span><span class="identifier">DataFrame</span><span class="delimiter">(</span>
        <span class="built_in_function">abs</span><span class="delimiter">(</span>
            <span class="identifier">report</span><span class="delimiter">[</span><span class="identifier">report</span><span class="delimiter">[</span><span class="string">"Type"] == "count"</span><span class="delimiter">]</span><span class="delimiter">.</span><span class="identifier">iloc</span><span class="delimiter">[</span><span class="delimiter">:</span><span class="delimiter">,</span> <span class="number">2</span><span class="delimiter">:</span><span class="delimiter">]</span><span class="delimiter">.</span><span class="identifier">values</span>
            <span class="operator">-</span> <span class="identifier">clustersize</span><span class="delimiter">.</span><span class="identifier">iloc</span><span class="delimiter">[</span><span class="delimiter">:</span><span class="delimiter">,</span> <span class="number">2</span><span class="delimiter">:</span><span class="delimiter">]</span><span class="delimiter">.</span><span class="identifier">values</span>
        <span class="delimiter">)</span>
    <span class="delimiter">)</span>  <span class="comment"># generating df with count of nan values</span>
    <span class="identifier">a</span><span class="delimiter">[</span><span class="string">"Features"</span><span class="delimiter">]</span> <span class="delimiter">=</span> <span class="number">0</span>
    <span class="identifier">a</span><span class="delimiter">[</span><span class="string">"Type"] = "# of nan"</span>
    <span class="identifier">a</span><span class="delimiter">.</span><span class="identifier">Features</span> <span class="delimiter">=</span> <span class="identifier">report</span><span class="delimiter">[</span>
        <span class="identifier">report</span><span class="delimiter">[</span><span class="string">"Type"] == "count"</span>
    <span class="delimiter">]</span><span class="delimiter">.</span><span class="identifier">Features</span><span class="delimiter">.</span><span class="identifier">tolist</span><span class="delimiter">(</span><span class="delimiter">)</span>  <span class="comment"># filling values in order to match report</span>
    <span class="identifier">cols</span> <span class="delimiter">=</span> <span class="identifier">a</span><span class="delimiter">.</span><span class="identifier">columns</span><span class="delimiter">.</span><span class="identifier">tolist</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="identifier">cols</span> <span class="delimiter">=</span> <span class="identifier">cols</span><span class="delimiter">[</span><span class="number">-2</span><span class="delimiter">:</span><span class="delimiter">]</span> <span class="operator">+</span> <span class="identifier">cols</span><span class="delimiter">[</span><span class="delimiter">:</span><span class="number">-2</span><span class="delimiter">]</span>
    <span class="identifier">a</span> <span class="delimiter">=</span> <span class="identifier">a</span><span class="delimiter">[</span><span class="identifier">cols</span><span class="delimiter">]</span>  <span class="comment"># rearrange columns to match report</span>
    <span class="identifier">a</span><span class="delimiter">.</span><span class="identifier">columns</span> <span class="delimiter">=</span> <span class="identifier">report</span><span class="delimiter">.</span><span class="identifier">columns</span>  <span class="comment"># rename columns to match report</span>
    <span class="identifier">report</span> <span class="delimiter">=</span> <span class="identifier">report</span><span class="delimiter">.</span><span class="identifier">drop</span><span class="delimiter">(</span>
        <span class="identifier">report</span><span class="delimiter">[</span><span class="identifier">report</span><span class="delimiter">.</span><span class="identifier">Type</span> <span class="delimiter">=</span> <span class="string">"count"</span><span class="delimiter">]</span><span class="delimiter">.</span><span class="identifier">index</span>
    <span class="delimiter">)</span>  <span class="comment"># drop count values except cluster size</span>
    <span class="identifier">report</span> <span class="delimiter">=</span> <span class="identifier">pd</span><span class="delimiter">.</span><span class="identifier">concat</span><span class="delimiter">(</span>
        <span class="delimiter">[</span><span class="identifier">report</span><span class="delimiter">,</span> <span class="identifier">a</span><span class="delimiter">,</span> <span class="identifier">clustersize</span><span class="delimiter">,</span> <span class="identifier">clusterproportion</span><span class="delimiter">]</span><span class="delimiter">,</span> <span class="identifier">axis</span><span class="delimiter">=</span><span class="number">0</span>
    <span class="delimiter">)</span>  <span class="comment"># concat report with clustert size and nan values</span>
    <span class="identifier">report</span><span class="delimiter">[</span><span class="string">"Mark"] = report["Features"</span><span class="delimiter">]</span><span class="delimiter">.</span><span class="identifier">isin</span><span class="delimiter">(</span><span class="identifier">clustering_variables</span><span class="delimiter">)</span>
    <span class="identifier">cols</span> <span class="delimiter">=</span> <span class="identifier">report</span><span class="delimiter">.</span><span class="identifier">columns</span><span class="delimiter">.</span><span class="identifier">tolist</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="identifier">cols</span> <span class="delimiter">=</span> <span class="identifier">cols</span><span class="delimiter">[</span><span class="number">0</span><span class="delimiter">:</span><span class="number">2</span><span class="delimiter">]</span> <span class="operator">+</span> <span class="identifier">cols</span><span class="delimiter">[</span><span class="number">-1</span><span class="delimiter">:</span><span class="delimiter">]</span> <span class="operator">+</span> <span class="identifier">cols</span><span class="delimiter">[</span><span class="number">2</span><span class="delimiter">:</span><span class="number">-1</span><span class="delimiter">]</span>
    <span class="identifier">report</span> <span class="delimiter">=</span> <span class="identifier">report</span><span class="delimiter">[</span><span class="identifier">cols</span><span class="delimiter">]</span>
    <span class="identifier">sorter1</span> <span class="delimiter">=</span> <span class="delimiter">{</span>
        <span class="string">"ClusterSize"</span><span class="delimiter">:</span> <span class="number">9</span><span class="delimiter">,</span>
        <span class="string">"ClusterProportion"</span><span class="delimiter">:</span> <span class="number">8</span><span class="delimiter">,</span>
        <span class="string">"mean_with_zeros"</span><span class="delimiter">:</span> <span class="number">7</span><span class="delimiter">,</span>
        <span class="string">"mean_with_na"</span><span class="delimiter">:</span> <span class="number">6</span><span class="delimiter">,</span>
        <span class="string">"max"</span><span class="delimiter">:</span> <span class="number">5</span><span class="delimiter">,</span>
        <span class="string">"50%"</span><span class="delimiter">:</span> <span class="number">4</span><span class="delimiter">,</span>
        <span class="string">"min"</span><span class="delimiter">:</span> <span class="number">3</span><span class="delimiter">,</span>
        <span class="string">"25%"</span><span class="delimiter">:</span> <span class="number">2</span><span class="delimiter">,</span>
        <span class="string">"75%"</span><span class="delimiter">:</span> <span class="number">1</span><span class="delimiter">,</span>
        <span class="string">"# of nan"</span><span class="delimiter">:</span> <span class="number">0</span><span class="delimiter">,</span>
        <span class="string">"# > 0"</span><span class="delimiter">:</span> <span class="number">-1</span><span class="delimiter">,</span>
        <span class="string">"sum_with_na"</span><span class="delimiter">:</span> <span class="number">-2</span><span class="delimiter">,</span>
    <span class="delimiter">}</span>
    <span class="identifier">report</span> <span class="delimiter">=</span> <span class="delimiter">(</span>
        <span class="identifier">report</span><span class="delimiter">.</span><span class="identifier">assign</span><span class="delimiter">(</span>
            <span class="identifier">Sorter1</span><span class="delimiter">=</span><span class="keyword">lambda</span> <span class="identifier">x</span><span class="delimiter">:</span> <span class="identifier">x</span><span class="delimiter">.</span><span class="identifier">Type</span><span class="delimiter">.</span><span class="built_in_function">map</span><span class="delimiter">(</span><span class="identifier">sorter1</span><span class="delimiter">)</span><span class="delimiter">,</span>
            <span class="identifier">Sorter2</span><span class="delimiter">=</span><span class="keyword">lambda</span> <span class="identifier">x</span><span class="delimiter">:</span> <span class="built_in_function">list</span><span class="delimiter">(</span><span class="built_in_function">reversed</span><span class="delimiter">(</span><span class="built_in_function">range</span><span class="delimiter">(</span><span class="built_in_function">len</span><span class="delimiter">(</span><span class="identifier">x</span><span class="delimiter">)</span><span class="delimiter">,</span>
        <span class="delimiter">)</span>
        <span class="delimiter">.</span><span class="identifier">sort_values</span><span class="delimiter">(</span><span class="delimiter">[</span><span class="string">"Sorter1", "Mark", "Sorter2"</span><span class="delimiter">]</span><span class="delimiter">,</span> <span class="identifier">ascending</span><span class="delimiter">=</span><span class="keyword">False</span><span class="delimiter">)</span>
        <span class="delimiter">.</span><span class="identifier">drop</span><span class="delimiter">(</span><span class="delimiter">[</span><span class="string">"Sorter1", "Sorter2"</span><span class="delimiter">]</span><span class="delimiter">,</span> <span class="identifier">axis</span><span class="delimiter">=</span><span class="number">1</span><span class="delimiter">)</span>
    <span class="delimiter">)</span>
    <span class="identifier">report</span><span class="delimiter">.</span><span class="identifier">columns</span><span class="delimiter">.</span><span class="identifier">name</span> <span class="delimiter">=</span> <span class="string">""</span>
    <span class="identifier">report</span> <span class="delimiter">=</span> <span class="identifier">report</span><span class="delimiter">.</span><span class="identifier">reset_index</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="identifier">report</span> <span class="delimiter">=</span> <span class="identifier">report</span><span class="delimiter">.</span><span class="identifier">drop</span><span class="delimiter">(</span><span class="identifier">columns</span><span class="delimiter">=</span><span class="delimiter">[</span><span class="string">"index"</span><span class="delimiter">]</span><span class="delimiter">)</span>
    <span class="keyword">return</span> <span class="identifier">report</span>


<span class="keyword">if</span> <span class="identifier">__name__</span> <span class="delimiter">=</span> <span class="string">"__main__"</span><span class="delimiter">:</span>
    <span class="keyword">import</span> <span class="identifier">doctest</span>

    <span class="identifier">doctest</span><span class="delimiter">.</span><span class="identifier">testmod</span><span class="delimiter">(</span><span class="delimiter">)</span>


            </code>
          </pre>
        </body>
      </html>